<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QuizForge</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        padding: 40px;
        max-width: 800px;
        width: 100%;
        position: relative;
        overflow: hidden;
      }

      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2);
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      h1 {
        color: #333;
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .language-switcher {
        display: flex;
        gap: 5px;
        background: #f8f9fa;
        border-radius: 8px;
        padding: 5px;
      }

      .lang-btn {
        background: transparent;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        color: #666;
        transition: all 0.3s ease;
      }

      .lang-btn.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
      }

      .lang-btn:hover:not(.active) {
        background: #e9ecef;
        color: #333;
      }

      .main-page {
        display: block;
      }

      .quiz-page {
        display: none;
      }

      .input-section {
        margin-bottom: 30px;
      }

      label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        color: #555;
        font-size: 1.1rem;
      }

      textarea {
        width: 100%;
        height: 200px;
        padding: 15px;
        border: 2px solid #e1e5e9;
        border-radius: 12px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        resize: vertical;
        transition: border-color 0.3s ease;
        background: #f8f9fa;
      }

      textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .button {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .button:active {
        transform: translateY(0);
      }

      .create-quiz-btn {
        display: block;
        margin: 20px auto;
        width: 200px;
      }

      .ai-instruction {
        background: #f8f9fa;
        border: 2px dashed #dee2e6;
        border-radius: 12px;
        padding: 20px;
        margin-top: 30px;
        position: relative;
      }

      .ai-instruction h3 {
        color: #495057;
        margin-bottom: 15px;
        font-size: 1.2rem;
      }

      .ai-instruction-text {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        line-height: 1.5;
        color: #495057;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
      }

      .ai-instruction-text:hover {
        background: #f1f3f4;
        border-color: #667eea;
      }

      .copy-hint {
        position: absolute;
        top: 10px;
        right: 15px;
        background: #667eea;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        opacity: 0.7;
      }

      .question-container {
        margin-bottom: 30px;
      }

      .question-number {
        color: #667eea;
        font-weight: 600;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .question {
        font-size: 1.3rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 25px;
        line-height: 1.4;
      }

      .options {
        display: grid;
        gap: 15px;
        margin-bottom: 25px;
      }

      .option {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 15px 20px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1.1rem;
        position: relative;
      }

      .option:hover {
        background: #e9ecef;
        border-color: #667eea;
      }

      .option.selected {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      .option.correct {
        background: #28a745;
        color: white;
        border-color: #28a745;
      }

      .option.incorrect {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
      }

      .option.disabled {
        cursor: not-allowed;
        opacity: 0.7;
      }

      .feedback {
        margin: 20px 0;
        padding: 15px;
        border-radius: 12px;
        font-weight: 600;
        display: none;
      }

      .feedback.correct {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .feedback.incorrect {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .explanation {
        margin-top: 10px;
        font-weight: normal;
        font-style: italic;
      }

      .next-btn {
        display: none;
        margin: 20px auto;
        width: 150px;
      }

      .progress {
        background: #e9ecef;
        border-radius: 10px;
        height: 8px;
        margin-bottom: 30px;
        overflow: hidden;
      }

      .progress-bar {
        background: linear-gradient(90deg, #667eea, #764ba2);
        height: 100%;
        transition: width 0.3s ease;
        border-radius: 10px;
      }

      .stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        font-weight: 600;
        color: #666;
      }

      .back-btn {
        background: #6c757d;
        margin-right: 10px;
        width: 120px;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
        border-radius: 8px;
        padding: 15px;
        margin: 15px 0;
        display: none;
      }

      .success-message {
        text-align: center;
        padding: 40px;
        color: #28a745;
        font-size: 1.3rem;
        font-weight: 600;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
          margin: 10px;
        }

        .header {
          flex-direction: column;
          gap: 20px;
          align-items: center;
        }

        h1 {
          font-size: 2rem;
        }

        .question {
          font-size: 1.2rem;
        }

        .option {
          padding: 12px 15px;
          font-size: 1rem;
        }

        .language-switcher {
          order: -1;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üî• <span data-translate="title">QuizForge</span></h1>
        <div class="language-switcher">
          <button class="lang-btn active" onclick="switchLanguage('en')">
            EN
          </button>
          <button class="lang-btn" onclick="switchLanguage('ru')">RU</button>
          <button class="lang-btn" onclick="switchLanguage('ky')">KY</button>
        </div>
      </div>

      <!-- Main Page -->
      <div id="mainPage" class="main-page">
        <div class="input-section">
          <label for="jsonInput" data-translate="enterQuizJson"
            >Enter Quiz JSON:</label
          >
          <textarea
            id="jsonInput"
            data-translate-placeholder="jsonPlaceholder"
          ></textarea>
        </div>

        <div class="error" id="errorMessage"></div>

        <button
          class="button create-quiz-btn"
          onclick="createQuiz()"
          data-translate="createQuiz"
        >
          Create Quiz
        </button>

        <div class="ai-instruction">
          <h3 data-translate="aiInstructionTitle">
            üìù AI Instruction (Click to Copy)
          </h3>
          <div
            class="ai-instruction-text"
            onclick="copyToClipboard()"
            id="aiInstruction"
          >
            <div class="copy-hint" data-translate="clickToCopy">
              Click to copy
            </div>
            <span data-translate="aiInstructionText"
              >Generate me quiz in json format like this: [{ "question": "What
              is 2 + 2?", "options": ["3", "2", "5", "4"], "correctAnswerIndex":
              3, "explanation": "2 + 2 equals 4 because it's basic arithmetic."
              }, { "question": "Capital of Thailand", "options": ["Bishkek",
              "Bangkok", "Baku", "Dushanbe"], "correctAnswerIndex": 1 }] on
              topic</span
            >
          </div>
        </div>
      </div>

      <!-- Quiz Page -->
      <div id="quizPage" class="quiz-page">
        <div class="stats">
          <span id="questionCounter">Question 1 of 10</span>
          <span id="mistakeCounter" data-translate="mistakes">Mistakes: 0</span>
        </div>

        <div class="progress">
          <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="question-container">
          <div
            class="question-number"
            id="questionNumber"
            data-translate="question"
          >
            Question 1
          </div>
          <div class="question" id="questionText"></div>

          <div class="options" id="optionsContainer"></div>

          <div class="feedback" id="feedback">
            <div id="feedbackText"></div>
            <div class="explanation" id="explanation"></div>
          </div>
        </div>

        <div style="text-align: center">
          <button class="button back-btn" onclick="backToMain()">
            ‚Üê <span data-translate="back">Back</span>
          </button>
          <button class="button next-btn" id="nextBtn" onclick="nextQuestion()">
            <span data-translate="next">Next</span> ‚Üí
          </button>
        </div>
      </div>
    </div>

    <script>
      // Language translations
      const translations = {
        en: {
          title: "QuizForge",
          enterQuizJson: "Enter Quiz JSON:",
          jsonPlaceholder: `[{
    "question": "What is 2 + 2?",
    "options": ["3", "2", "5", "4"],
    "correctAnswerIndex": 3,
    "explanation": "2 + 2 equals 4 because it's basic arithmetic."
},
{
    "question": "Capital of Thailand",
    "options": ["Bishkek", "Bangkok", "Baku", "Dushanbe"],
    "correctAnswerIndex": 1
}]`,
          createQuiz: "Create Quiz",
          aiInstructionTitle: "üìù AI Instruction (Click to Copy)",
          clickToCopy: "Click to copy",
          aiInstructionText: `Generate me quiz in json format like this:
[{
    "question": "What is 2 + 2?",
    "options": ["3", "2", "5", "4"],
    "correctAnswerIndex": 3,
    "explanation": "2 + 2 equals 4 because it's basic arithmetic."
},
{
    "question": "Capital of Thailand",
    "options": ["Bishkek", "Bangkok", "Baku", "Dushanbe"],
    "correctAnswerIndex": 1
}]
on topic`,
          question: "Question",
          mistakes: "Mistakes:",
          back: "Back",
          next: "Next",
          correct: "üéâ Correct!",
          incorrect: "‚ùå Incorrect!",
          quizCompleted: "üéä Quiz Completed!",
          greatJob: "Great job! You've answered all questions correctly.",
          totalMistakes: "Total mistakes made:",
          createNewQuiz: "Create New Quiz",
          pleaseEnterJson: "Please enter quiz JSON data",
          invalidArray: "JSON must be an array with at least one question",
          invalidQuestion: "Invalid question format at index",
          invalidJson: "Invalid JSON format. Please check your syntax.",
          copied: "Copied!",
        },
        ru: {
          title: "–ö–≤–∏–∑–§–æ—Ä–¥–∂",
          enterQuizJson: "–í–≤–µ–¥–∏—Ç–µ JSON –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã:",
          jsonPlaceholder: `[{
    "question": "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?",
    "options": ["3", "2", "5", "4"],
    "correctAnswerIndex": 3,
    "explanation": "2 + 2 —Ä–∞–≤–Ω–æ 4, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –±–∞–∑–æ–≤–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞."
},
{
    "question": "–°—Ç–æ–ª–∏—Ü–∞ –¢–∞–∏–ª–∞–Ω–¥–∞",
    "options": ["–ë–∏—à–∫–µ–∫", "–ë–∞–Ω–≥–∫–æ–∫", "–ë–∞–∫—É", "–î—É—à–∞–Ω–±–µ"],
    "correctAnswerIndex": 1
}]`,
          createQuiz: "–°–æ–∑–¥–∞—Ç—å –≤–∏–∫—Ç–æ—Ä–∏–Ω—É",
          aiInstructionTitle:
            "üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ò–ò (–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å)",
          clickToCopy: "–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å",
          aiInstructionText: `–°–æ–∑–¥–∞–π –º–Ω–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ json –≤–æ—Ç —Ç–∞–∫:
[{
    "question": "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 2 + 2?",
    "options": ["3", "2", "5", "4"],
    "correctAnswerIndex": 3,
    "explanation": "2 + 2 —Ä–∞–≤–Ω–æ 4, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –±–∞–∑–æ–≤–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞."
},
{
    "question": "–°—Ç–æ–ª–∏—Ü–∞ –¢–∞–∏–ª–∞–Ω–¥–∞",
    "options": ["–ë–∏—à–∫–µ–∫", "–ë–∞–Ω–≥–∫–æ–∫", "–ë–∞–∫—É", "–î—É—à–∞–Ω–±–µ"],
    "correctAnswerIndex": 1
}]
–Ω–∞ —Ç–µ–º—É`,
          question: "–í–æ–ø—Ä–æ—Å",
          mistakes: "–û—à–∏–±–∫–∏:",
          back: "–ù–∞–∑–∞–¥",
          next: "–î–∞–ª–µ–µ",
          correct: "üéâ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!",
          incorrect: "‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!",
          quizCompleted: "üéä –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!",
          greatJob: "–û—Ç–ª–∏—á–Ω–æ! –í—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã.",
          totalMistakes: "–í—Å–µ–≥–æ –æ—à–∏–±–æ–∫:",
          createNewQuiz: "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≤–∏–∫—Ç–æ—Ä–∏–Ω—É",
          pleaseEnterJson: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ JSON –¥–∞–Ω–Ω—ã–µ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã",
          invalidArray: "JSON –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º —Å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∏–º –≤–æ–ø—Ä–æ—Å–æ–º",
          invalidQuestion: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤–æ–ø—Ä–æ—Å–∞ –≤ –∏–Ω–¥–µ–∫—Å–µ",
          invalidJson: "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å.",
          copied: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!",
        },
        ky: {
          title: "–ö–≤–∏–∑–§–æ—Ä–¥–∂",
          enterQuizJson: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞–Ω—ã–Ω JSON –º–∞–∞–ª—ã–º–∞—Ç—ã–Ω –∫–∏—Ä–≥–∏–∑–∏“£–∏–∑:",
          jsonPlaceholder: `[{
    "question": "2 + 2 –∫–∞–Ω—á–∞ –±–æ–ª–æ—Ç?",
    "options": ["3", "2", "5", "4"],
    "correctAnswerIndex": 3,
    "explanation": "2 + 2 = 4, –∞–Ω—Ç–∫–µ–Ω–∏ –±—É–ª –Ω–µ–≥–∏–∑–≥–∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞."
},
{
    "question": "–¢–∞–π–ª–∞–Ω–¥–¥—ã–Ω –±–æ—Ä–±–æ—Ä—É",
    "options": ["–ë–∏—à–∫–µ–∫", "–ë–∞–Ω–≥–∫–æ–∫", "–ë–∞–∫—É", "–î—É—à–∞–Ω–±–µ"],
    "correctAnswerIndex": 1
}]`,
          createQuiz: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Ç“Ø–∑“Ø“Ø",
          aiInstructionTitle: "üìù AI “Ø—á“Ø–Ω –∫”©—Ä—Å”©—Ç–º”© (–ö”©—á“Ø—Ä“Ø“Ø “Ø—á“Ø–Ω –±–∞—Å—ã“£—ã–∑)",
          clickToCopy: "–ö”©—á“Ø—Ä“Ø“Ø “Ø—á“Ø–Ω –±–∞—Å—ã“£—ã–∑",
          aiInstructionText: `–ú–∞–≥–∞ —É—à—É–Ω–¥–∞–π json —Ñ–æ—Ä–º–∞—Ç—ã–Ω–¥–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Ç“Ø–∑“Ø–ø –±–µ—Ä–∏“£–∏–∑:
[{
    "question": "2 + 2 –∫–∞–Ω—á–∞ –±–æ–ª–æ—Ç?",
    "options": ["3", "2", "5", "4"],
    "correctAnswerIndex": 3,
    "explanation": "2 + 2 = 4, –∞–Ω—Ç–∫–µ–Ω–∏ –±—É–ª –Ω–µ–≥–∏–∑–≥–∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞."
},
{
    "question": "–¢–∞–π–ª–∞–Ω–¥–¥—ã–Ω –±–æ—Ä–±–æ—Ä—É",
    "options": ["–ë–∏—à–∫–µ–∫", "–ë–∞–Ω–≥–∫–æ–∫", "–ë–∞–∫—É", "–î—É—à–∞–Ω–±–µ"],
    "correctAnswerIndex": 1
}]
—Ç–µ–º–∞: `,
          question: "–°—É—Ä–æ–æ",
          mistakes: "–ö–∞—Ç–∞–ª–∞—Ä:",
          back: "–ê—Ä—Ç–∫–∞",
          next: "–ö–∏–π–∏–Ω–∫–∏",
          correct: "üéâ –¢—É—É—Ä–∞!",
          incorrect: "‚ùå –¢—É—É—Ä–∞ —ç–º–µ—Å!",
          quizCompleted: "üéä –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∞—è–∫—Ç–∞–¥—ã!",
          greatJob: "–°–æ–Ω—É–Ω! –°–∏–∑ –±–∞—Ä–¥—ã–∫ —Å—É—Ä–æ–æ–ª–æ—Ä–≥–æ —Ç—É—É—Ä–∞ –∂–æ–æ–ø –±–µ—Ä–¥–∏“£–∏–∑.",
          totalMistakes: "–ñ–∞–ª–ø—ã –∫–∞—Ç–∞–ª–∞—Ä:",
          createNewQuiz: "–ñ–∞“£—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞ —Ç“Ø–∑“Ø“Ø",
          pleaseEnterJson: "–í–∏–∫—Ç–æ—Ä–∏–Ω–∞–Ω—ã–Ω JSON –º–∞–∞–ª—ã–º–∞—Ç—ã–Ω –∫–∏—Ä–≥–∏–∑–∏“£–∏–∑",
          invalidArray: "JSON –∫–µ–º–∏–Ω–¥–µ –±–∏—Ä —Å—É—Ä–æ–æ –º–µ–Ω–µ–Ω –º–∞—Å—Å–∏–≤ –±–æ–ª—É—à—É –∫–µ—Ä–µ–∫",
          invalidQuestion: "–°—É—Ä–æ–æ–Ω—É–Ω —Ñ–æ—Ä–º–∞—Ç—ã —Ç—É—É—Ä–∞ —ç–º–µ—Å",
          invalidJson: "JSON —Ñ–æ—Ä–º–∞—Ç—ã —Ç—É—É—Ä–∞ —ç–º–µ—Å. –°–∏–Ω—Ç–∞–∫—Å–∏—Å—Ç–∏ —Ç–µ–∫—à–µ—Ä–∏“£–∏–∑.",
          copied: "–ö”©—á“Ø—Ä“Ø–ª–¥“Ø!",
        },
      };

      let currentLanguage = "en";
      let quizData = [];
      let currentQuestionIndex = 0;
      let mistakeQuestions = [];
      let totalMistakes = 0;
      let selectedOption = null;
      let isAnswered = false;

      function switchLanguage(lang) {
        currentLanguage = lang;

        // Update active button
        document
          .querySelectorAll(".lang-btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        // Update all translatable elements
        document.querySelectorAll("[data-translate]").forEach((element) => {
          const key = element.getAttribute("data-translate");
          if (translations[lang][key]) {
            element.textContent = translations[lang][key];
          }
        });

        // Update placeholder
        const textarea = document.getElementById("jsonInput");
        if (translations[lang].jsonPlaceholder) {
          textarea.placeholder = translations[lang].jsonPlaceholder;
        }

        // Update AI instruction text content
        const aiInstructionSpan = document.querySelector(
          '#aiInstruction span[data-translate="aiInstructionText"]'
        );
        if (aiInstructionSpan && translations[lang].aiInstructionText) {
          aiInstructionSpan.textContent = translations[lang].aiInstructionText;
        }
      }

      function showError(messageKey) {
        const errorDiv = document.getElementById("errorMessage");
        errorDiv.textContent =
          translations[currentLanguage][messageKey] || messageKey;
        errorDiv.style.display = "block";
        setTimeout(() => {
          errorDiv.style.display = "none";
        }, 5000);
      }

      function createQuiz() {
        const jsonInput = document.getElementById("jsonInput").value.trim();

        if (!jsonInput) {
          showError("pleaseEnterJson");
          return;
        }

        try {
          const data = JSON.parse(jsonInput);

          if (!Array.isArray(data) || data.length === 0) {
            showError("invalidArray");
            return;
          }

          // Validate each question
          for (let i = 0; i < data.length; i++) {
            const q = data[i];
            if (
              !q.question ||
              !Array.isArray(q.options) ||
              q.options.length < 2 ||
              typeof q.correctAnswerIndex !== "number" ||
              q.correctAnswerIndex < 0 ||
              q.correctAnswerIndex >= q.options.length
            ) {
              showError("invalidQuestion" + " " + i);
              return;
            }
          }

          quizData = data;
          currentQuestionIndex = 0;
          mistakeQuestions = [];
          totalMistakes = 0;
          startQuiz();
        } catch (error) {
          showError("invalidJson");
        }
      }

      function startQuiz() {
        document.getElementById("mainPage").style.display = "none";
        document.getElementById("quizPage").style.display = "block";
        displayQuestion();
      }

      function displayQuestion() {
        const question = quizData[currentQuestionIndex];
        selectedOption = null;
        isAnswered = false;

        // Update question counter and progress
        const totalQuestions = quizData.length + mistakeQuestions.length;
        const currentPosition = currentQuestionIndex + 1;
        document.getElementById("questionCounter").textContent = `${
          translations[currentLanguage].question
        } ${currentPosition} ${
          translations[currentLanguage].question === "Question"
            ? "of"
            : translations[currentLanguage].question === "–í–æ–ø—Ä–æ—Å"
            ? "–∏–∑"
            : "–¥–∞–Ω"
        } ${totalQuestions}`;
        document.getElementById(
          "mistakeCounter"
        ).textContent = `${translations[currentLanguage].mistakes} ${totalMistakes}`;

        const progress = (currentQuestionIndex / quizData.length) * 100;
        document.getElementById("progressBar").style.width = progress + "%";

        // Display question
        document.getElementById(
          "questionNumber"
        ).textContent = `${translations[currentLanguage].question} ${currentPosition}`;
        document.getElementById("questionText").textContent = question.question;

        // Display options
        const optionsContainer = document.getElementById("optionsContainer");
        optionsContainer.innerHTML = "";

        question.options.forEach((option, index) => {
          const optionDiv = document.createElement("div");
          optionDiv.className = "option";
          optionDiv.textContent = option;
          optionDiv.onclick = () => selectOption(index);
          optionsContainer.appendChild(optionDiv);
        });

        // Hide feedback and next button
        document.getElementById("feedback").style.display = "none";
        document.getElementById("nextBtn").style.display = "none";
      }

      function selectOption(index) {
        if (isAnswered) return;

        selectedOption = index;
        isAnswered = true;

        const question = quizData[currentQuestionIndex];
        const options = document.querySelectorAll(".option");
        const feedback = document.getElementById("feedback");
        const feedbackText = document.getElementById("feedbackText");
        const explanation = document.getElementById("explanation");

        // Disable all options
        options.forEach((option) => option.classList.add("disabled"));

        // Show correct answer
        options[question.correctAnswerIndex].classList.add("correct");

        if (index === question.correctAnswerIndex) {
          // Correct answer
          feedbackText.textContent = translations[currentLanguage].correct;
          feedback.className = "feedback correct";
        } else {
          // Wrong answer
          options[index].classList.add("incorrect");
          feedbackText.textContent = translations[currentLanguage].incorrect;
          feedback.className = "feedback incorrect";

          // Add to mistake questions if not already there
          if (
            !mistakeQuestions.some(
              (q) => q.originalIndex === currentQuestionIndex
            )
          ) {
            mistakeQuestions.push({
              ...question,
              originalIndex: currentQuestionIndex,
            });
          }
          totalMistakes++;
        }

        // Show explanation if available
        if (question.explanation) {
          explanation.textContent = question.explanation;
          explanation.style.display = "block";
        } else {
          explanation.style.display = "none";
        }

        feedback.style.display = "block";
        document.getElementById("nextBtn").style.display = "inline-block";
      }

      function nextQuestion() {
        currentQuestionIndex++;

        if (currentQuestionIndex >= quizData.length) {
          // Check if there are mistake questions to retry
          if (mistakeQuestions.length > 0) {
            // Move mistake questions to main quiz data
            quizData = mistakeQuestions;
            mistakeQuestions = [];
            currentQuestionIndex = 0;
            displayQuestion();
          } else {
            // Quiz completed
            showCompletion();
          }
        } else {
          displayQuestion();
        }
      }

      function showCompletion() {
        const quizPage = document.getElementById("quizPage");
        quizPage.innerHTML = `
                <div class="success-message">
                    <h2>${translations[currentLanguage].quizCompleted}</h2>
                    <p>${translations[currentLanguage].greatJob}</p>
                    <p>${translations[currentLanguage].totalMistakes} ${totalMistakes}</p>
                    <button class="button" onclick="backToMain()" style="margin-top: 30px;">${translations[currentLanguage].createNewQuiz}</button>
                </div>
            `;
      }

      function backToMain() {
        document.getElementById("mainPage").style.display = "block";
        document.getElementById("quizPage").style.display = "none";

        // Reset quiz page content in case it was modified
        document.getElementById("quizPage").innerHTML = `
                <div class="stats">
                    <span id="questionCounter">Question 1 of 10</span>
                    <span id="mistakeCounter" data-translate="mistakes">${translations[currentLanguage].mistakes} 0</span>
                </div>
                
                <div class="progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                
                <div class="question-container">
                    <div class="question-number" id="questionNumber" data-translate="question">${translations[currentLanguage].question} 1</div>
                    <div class="question" id="questionText"></div>
                    
                    <div class="options" id="optionsContainer"></div>
                    
                    <div class="feedback" id="feedback">
                        <div id="feedbackText"></div>
                        <div class="explanation" id="explanation"></div>
                    </div>
                </div>
                
                <div style="text-align: center;">
                    <button class="button back-btn" onclick="backToMain()">‚Üê <span data-translate="back">${translations[currentLanguage].back}</span></button>
                    <button class="button next-btn" id="nextBtn" onclick="nextQuestion()"><span data-translate="next">${translations[currentLanguage].next}</span> ‚Üí</button>
                </div>
            `;
      }

      function copyToClipboard() {
        const aiInstructionSpan = document.querySelector(
          '#aiInstruction span[data-translate="aiInstructionText"]'
        );
        const text = aiInstructionSpan
          ? aiInstructionSpan.textContent
          : translations[currentLanguage].aiInstructionText;

        if (navigator.clipboard) {
          navigator.clipboard.writeText(text).then(() => {
            showCopySuccess();
          });
        } else {
          // Fallback for older browsers
          const textArea = document.createElement("textarea");
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand("copy");
          document.body.removeChild(textArea);
          showCopySuccess();
        }
      }

      function showCopySuccess() {
        const hint = document.querySelector(".copy-hint");
        const originalText = hint.textContent;
        hint.textContent = translations[currentLanguage].copied;
        hint.style.background = "#28a745";

        setTimeout(() => {
          hint.textContent = translations[currentLanguage].clickToCopy;
          hint.style.background = "#667eea";
        }, 2000);
      }

      // Initialize with default language
      document.addEventListener("DOMContentLoaded", function () {
        switchLanguage("en");
      });
    </script>
  </body>
</html>
